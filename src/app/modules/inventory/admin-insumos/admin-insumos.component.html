<div class="admin-insumos-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-nav">
        <button 
          *ngIf="vista === 'insumos'" 
          class="btn-volver"
          (click)="volverACategorias()">
          <i class="fas fa-arrow-left"></i>
          Volver a categorías
        </button>
        <h1 class="title">
          {{ vista === 'categorias' ? 'Categorías de Insumos' : 'Insumos - ' + categoriaSeleccionada?.inputcategoryname }}
        </h1>
      </div>
    </div>
  </div>

  <!-- Vista de Categorías -->
  <div *ngIf="vista === 'categorias'" class="grid-container">
    <!-- Cards de categorías existentes -->
    <div 
      *ngFor="let categoria of todasLasCategoriasInsumos" 
      class="card-wrapper">
      <div 
        class="card categoria-card"
        [ngClass]="{'card-inactive': !categoria.stateinputcategory}"
        (click)="verInsumos(categoria)">
        <div class="card-overlay" *ngIf="!categoria.stateinputcategory">
          <span class="inactive-label">INACTIVO</span>
        </div>
        <div class="card-icon-container">
          <img
            *ngIf="categoria.inputcategoryimg; else iconTemplate"
            [src]="categoria.inputcategoryimg"
            [alt]="categoria.inputcategoryname"
            class="card-image">
          <ng-template #iconTemplate>
            <i class="fas fa-boxes card-icon categoria-icon"></i>
          </ng-template>
        </div>
        <div class="card-content">
          <h3 class="card-title">{{ categoria.inputcategoryname }}</h3>
          <p class="card-description">{{ categoria.inputcategorydescription }}</p>
        </div>
      </div>
      <div class="card-actions">
        <button
          class="btn-edit"
          (click)="abrirModalCategoria(categoria); $event.stopPropagation()">
          <i class="fas fa-edit"></i>
        </button>
        <button
          class="btn-delete"
          (click)="eliminarCategoria(categoria); $event.stopPropagation()">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    
    <!-- Card para agregar nueva categoría -->
    <div 
      class="card add-card"
      (click)="abrirModalCategoria()">
      <div class="add-card-content">
        <i class="fas fa-plus add-icon"></i>
        <p class="add-text">Agregar Categoría</p>
      </div>
    </div>
  </div>

  <!-- Vista de Insumos -->
  <div *ngIf="vista === 'insumos'" class="grid-container">
    <!-- Cards de insumos existentes -->
    <div 
      *ngFor="let insumo of todosLosInsumosDeCategoria" 
      class="card-wrapper">
      <div 
        class="card insumo-card"
        [ngClass]="{'card-inactive': !insumo.status}">
        <div class="card-overlay" *ngIf="!insumo.status">
          <span class="inactive-label">INACTIVO</span>
        </div>
        <div class="card-icon-container">
          <img
            *ngIf="insumo.supplyImg; else iconTemplate"
            [src]="insumo.supplyImg"
            [alt]="insumo.supplyName"
            class="card-image">
          <ng-template #iconTemplate>
            <i class="fas fa-cube card-icon insumo-icon"></i>
          </ng-template>
        </div>
        <div class="card-content">
          <h3 class="card-title">{{ insumo.supplyName }}</h3>
          <div class="stock-info">
            <span class="stock-cantidad">Stock: {{ insumo.currentStock }} {{ insumo.unitOfMeasure }}</span>
            <span class="stock-badge" [ngClass]="getStockClass(insumo.currentStock)">
              {{ getStockText(insumo.currentStock) }}
            </span>
          </div>
        </div>
      </div>
      <div class="card-actions">
        <button
          class="btn-edit"
          (click)="abrirModalInsumo(insumo)">
          <i class="fas fa-edit"></i>
        </button>
        <button
          class="btn-delete"
          (click)="eliminarInsumo(insumo)">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    
    <!-- Card para agregar nuevo insumo -->
    <div 
      class="card add-card"
      (click)="abrirModalInsumo()">
      <div class="add-card-content">
        <i class="fas fa-plus add-icon"></i>
        <p class="add-text">Agregar Insumo</p>
      </div>
    </div>
  </div>

  <!-- Modal Categoría -->
  <div *ngIf="mostrarModalCategoria" class="modal-overlay" (click)="cerrarModalCategoria()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">
          {{ editandoCategoria ? 'Editar Categoría' : 'Nueva Categoría' }}
        </h2>
        <button class="btn-close" (click)="cerrarModalCategoria()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nombre de la Categoría</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="formCategoria.inputcategoryname"
            placeholder="Ej: Perecibles">
        </div>
        
        <div class="form-group">
          <label class="form-label">Descripción</label>
          <textarea
            class="form-textarea"
            [(ngModel)]="formCategoria.inputcategorydescription"
            placeholder="Descripción de la categoría"
            rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Imagen</label>
          <div class="image-upload-container">
            <input
              type="file"
              accept="image/*"
              (change)="onFileSelected($event, 'categoria')"
              class="file-input"
              id="categoria-image">
            <label for="categoria-image" class="file-input-label">
              <i class="fas fa-camera"></i>
              Seleccionar imagen
            </label>
            <button 
              *ngIf="formCategoria.inputcategoryimg" 
              type="button" 
              class="btn-clear-image"
              (click)="limpiarImagen('categoria')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div *ngIf="formCategoria.inputcategoryimg" class="image-preview">
            <img [src]="formCategoria.inputcategoryimg" alt="Vista previa" class="preview-image">
          </div>
        </div>

        <div class="form-group">
          <label class="form-checkbox-container">
            <input 
              type="checkbox" 
              [(ngModel)]="formCategoria.stateinputcategory"
              class="form-checkbox">
            <span class="form-checkbox-label">Categoría activa</span>
          </label>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModalCategoria()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="guardarCategoria()">
          <i class="fas fa-save"></i>
          Guardar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Insumo -->
  <div *ngIf="mostrarModalInsumo" class="modal-overlay" (click)="cerrarModalInsumo()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">
          {{ editandoInsumo ? 'Editar Insumo' : 'Nuevo Insumo' }}
        </h2>
        <button class="btn-close" (click)="cerrarModalInsumo()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nombre del Insumo</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="formInsumo.supplyName"
            placeholder="Ej: Pollo Entero">
        </div>
        
        <div class="form-group">
          <label class="form-label">Unidad de Medida</label>
          <select
            class="form-select"
            [(ngModel)]="formInsumo.unitOfMeasure">
            <option value="">Seleccionar unidad</option>
            <option *ngFor="let unidad of unidadesMedida" [value]="unidad">
              {{ unidad === 'Kg' ? 'Kilogramos (Kg)' : 
                 unidad === 'Litros' ? 'Litros' :
                 unidad === 'Unidades' ? 'Unidades' :
                 unidad === 'Gramos' ? 'Gramos (g)' :
                 unidad === 'Ml' ? 'Mililitros (ml)' : unidad }}
            </option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Stock Actual</label>
          <input
            type="number"
            step="0.01"
            class="form-input"
            [(ngModel)]="formInsumo.currentStock"
            placeholder="0.00">
        </div>
        
        <div class="form-group">
          <label class="form-label">Imagen</label>
          <div class="image-upload-container">
            <input
              type="file"
              accept="image/*"
              (change)="onFileSelected($event, 'insumo')"
              class="file-input"
              id="insumo-image">
            <label for="insumo-image" class="file-input-label">
              <i class="fas fa-camera"></i>
              Seleccionar imagen
            </label>
            <button 
              *ngIf="formInsumo.supplyImg" 
              type="button" 
              class="btn-clear-image"
              (click)="limpiarImagen('insumo')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div *ngIf="formInsumo.supplyImg" class="image-preview">
            <img [src]="formInsumo.supplyImg" alt="Vista previa" class="preview-image">
          </div>
        </div>

        <div class="form-group">
          <label class="form-checkbox-container">
            <input 
              type="checkbox" 
              [(ngModel)]="formInsumo.status"
              class="form-checkbox">
            <span class="form-checkbox-label">Insumo activo</span>
          </label>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModalInsumo()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="guardarInsumo()">
          <i class="fas fa-save"></i>
          Guardar
        </button>
      </div>
    </div>
  </div>
</div>