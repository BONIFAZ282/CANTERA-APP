<div class="admin-categorias-productos-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-nav">
        <button 
          *ngIf="vista === 'productos'" 
          class="btn-volver"
          (click)="volverACategorias()">
          <i class="fas fa-arrow-left"></i>
          Volver a categorías
        </button>
        <h1 class="title">
          {{ vista === 'categorias' ? 'Categorías de Productos' : 'Productos - ' + categoriaSeleccionada?.nameCategory }}
        </h1>
      </div>
    </div>
  </div>

  <!-- Vista de Categorías -->
  <div *ngIf="vista === 'categorias'" class="grid-container">
    <!-- Cards de categorías existentes -->
    <div 
      *ngFor="let categoria of todasLasCategorias"
      class="card-wrapper">
      <div 
        class="card categoria-card"
        (click)="verProductos(categoria)">
        <img
          [src]="categoria.imageCategory"
          [alt]="categoria.nameCategory"
          class="card-image">
        <div class="card-content">
          <h3 class="card-title">{{ categoria.nameCategory }}</h3>
          <p class="card-description">{{ categoria.descriptionCategory }}</p>
        </div>
      </div>
      <div class="card-actions">
        <button
          class="btn-edit"
          (click)="abrirModalCategoria(categoria); $event.stopPropagation()">
          <i class="fas fa-edit"></i>
        </button>
        <button
          class="btn-delete"
          (click)="eliminarCategoria(categoria); $event.stopPropagation()">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    
    <!-- Card para agregar nueva categoría -->
    <div 
      class="card add-card"
      (click)="abrirModalCategoria()">
      <div class="add-card-content">
        <i class="fas fa-plus add-icon"></i>
        <p class="add-text">Agregar Categoría</p>
      </div>
    </div>
  </div>

  <!-- Vista de Productos -->
  <div *ngIf="vista === 'productos'" class="grid-container">
    <!-- Cards de productos existentes -->
    <div 
      *ngFor="let producto of todosLosProductosDeCategoria" 
      class="card-wrapper">
      <div 
        class="card producto-card"
        [ngClass]="{'card-inactive': !producto.stateproduct}">
        <div class="card-overlay" *ngIf="!producto.stateproduct">
          <span class="inactive-label">INACTIVO</span>
        </div>
        <img
          [src]="producto.productimg"
          [alt]="producto.productName"
          class="card-image">
        <div class="card-content">
          <h3 class="card-title">{{ producto.productName }}</h3>
          <p class="card-description">{{ producto.productDescription }}</p>
          <div class="precio-info">
            <span class="precio">S/ {{ producto.productPryce | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>
      <div class="card-actions">
        <button
          class="btn-edit"
          (click)="abrirModalProducto(producto)">
          <i class="fas fa-edit"></i>
        </button>
        <button
          class="btn-delete"
          (click)="eliminarProducto(producto)">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    
    <!-- Card para agregar nuevo producto -->
    <div 
      class="card add-card"
      (click)="abrirModalProducto()">
      <div class="add-card-content">
        <i class="fas fa-plus add-icon"></i>
        <p class="add-text">Agregar Producto</p>
      </div>
    </div>
  </div>

  <!-- Modal Categoría -->
  <div *ngIf="mostrarModalCategoria" class="modal-overlay" (click)="cerrarModalCategoria()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">
          {{ editandoCategoria ? 'Editar Categoría' : 'Nueva Categoría' }}
        </h2>
        <button class="btn-close" (click)="cerrarModalCategoria()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nombre de la Categoría</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="formCategoria.nameCategory"
            placeholder="Ej: Comidas Principales">
        </div>
        
        <div class="form-group">
          <label class="form-label">Descripción</label>
          <textarea
            class="form-textarea"
            [(ngModel)]="formCategoria.descriptionCategory"
            placeholder="Descripción de la categoría"
            rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Imagen</label>
          <div class="image-upload-container">
            <input
              type="file"
              accept="image/*"
              (change)="onFileSelected($event, 'categoria')"
              class="file-input"
              id="categoria-image">
            <label for="categoria-image" class="file-input-label">
              <i class="fas fa-camera"></i>
              Seleccionar imagen
            </label>
            <button 
              *ngIf="formCategoria.imageCategory" 
              type="button" 
              class="btn-clear-image"
              (click)="limpiarImagen('categoria')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div *ngIf="formCategoria.imageCategory" class="image-preview">
            <img [src]="formCategoria.imageCategory" alt="Vista previa" class="preview-image">
          </div>
        </div>

        <div class="form-group">
          <label class="form-checkbox-container">
            <input 
              type="checkbox" 
              [(ngModel)]="formCategoria.stateCategory"
              class="form-checkbox">
            <span class="form-checkbox-label">Categoría activa</span>
          </label>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModalCategoria()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="guardarCategoria()">
          <i class="fas fa-save"></i>
          Guardar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Producto -->
  <div *ngIf="mostrarModalProducto" class="modal-overlay" (click)="cerrarModalProducto()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">
          {{ editandoProducto ? 'Editar Producto' : 'Nuevo Producto' }}
        </h2>
        <button class="btn-close" (click)="cerrarModalProducto()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nombre del Producto</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="formProducto.productName"
            placeholder="Ej: Pizza Margherita">
        </div>
        
        <div class="form-group">
          <label class="form-label">Descripción</label>
          <textarea
            class="form-textarea"
            [(ngModel)]="formProducto.productDescription"
            placeholder="Descripción del producto"
            rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Precio (S/)</label>
          <input
            type="number"
            step="0.01"
            class="form-input"
            [(ngModel)]="formProducto.productPryce"
            placeholder="0.00">
        </div>
        
        <div class="form-group">
          <label class="form-label">Imagen</label>
          <div class="image-upload-container">
            <input
              type="file"
              accept="image/*"
              (change)="onFileSelected($event, 'producto')"
              class="file-input"
              id="producto-image">
            <label for="producto-image" class="file-input-label">
              <i class="fas fa-camera"></i>
              Seleccionar imagen
            </label>
            <button 
              *ngIf="formProducto.productimg" 
              type="button" 
              class="btn-clear-image"
              (click)="limpiarImagen('producto')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div *ngIf="formProducto.productimg" class="image-preview">
            <img [src]="formProducto.productimg" alt="Vista previa" class="preview-image">
          </div>
        </div>

        <div class="form-group">
          <label class="form-checkbox-container">
            <input 
              type="checkbox" 
              [(ngModel)]="formProducto.stateproduct"
              class="form-checkbox">
            <span class="form-checkbox-label">Producto activo</span>
          </label>
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="cerrarModalProducto()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="guardarProducto()">
          <i class="fas fa-save"></i>
          Guardar
        </button>
      </div>
    </div>
  </div>
</div>